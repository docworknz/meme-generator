module.exports=[72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},60350,a=>{"use strict";var b=a.i(87924),c=a.i(8706),d=a.i(86179),e=a.i(42588),f=a.i(72131);a.i(81861);var g=a.i(24249);let h=[];function i(a,b,c){return Math.min(c,Math.max(b,a))}function j(){let a=(0,f.useRef)(null),d=(0,f.useRef)(null),e=(0,f.useRef)(1),j=(0,f.useRef)({active:!1,offsetX:0,offsetY:0}),k=(0,f.useRef)({active:!1,handle:null,anchor:null}),l=c.db.useUser(),[m,n]=(0,f.useState)(null),[o,p]=(0,f.useState)([]),[q,r]=(0,f.useState)(null),[s,t]=(0,f.useState)(!1),u=o.find(a=>a.id===q),v=(0,f.useCallback)(()=>{let a=d.current;return a?i(480,100,Math.max(100,a.naturalWidth-48)):240},[]),w=(0,f.useCallback)(()=>{if(!d.current)return;let a=d.current,b={id:e.current++,text:"New Text",x:a.naturalWidth/2,y:a.naturalHeight/2,fontSize:48,fillColor:"#ffffff",strokeColor:"#000000",wrapWidth:v()};p(a=>[...a,b]),r(b.id)},[v]),x=(0,f.useCallback)(()=>{null!=q&&(p(a=>a.filter(a=>a.id!==q)),r(null))},[q]),y=(0,f.useCallback)((a,b)=>{p(c=>c.map(c=>c.id===a?{...c,...b}:c))},[]),z=a=>a.split("\n").map(a=>a.trim()),A=a=>z(a).some(a=>a.length>0),B=(a,b,c)=>{let d=[];return z(b).forEach(b=>{((a,b,c)=>{if(c<=0||!b)return[""];let d=b.split(/\s+/);if(0===d.length)return[""];let e=[],f=d[0],g=()=>{if(a.measureText(f).width<=c)e.push(f),f="";else{let b=((a,b,c)=>{let d=[],e=b;for(;e&&a.measureText(e).width>c;){let b="";for(let d=0;d<e.length;d++)if(a.measureText(b+e[d]).width<=c)b+=e[d];else break;b?(d.push(b),e=e.slice(b.length)):(d.push(e[0]),e=e.slice(1))}return e&&d.push(e),d})(a,f,c);for(let a=0;a<b.length-1;a++)e.push(b[a]);f=b[b.length-1]||""}};g();for(let b=1;b<d.length;b++){let e=f?f+" "+d[b]:d[b];a.measureText(e).width<=c?f=e:(f&&g(),f=d[b],g())}return f&&e.push(f),e})(a,b,c).forEach(a=>d.push(a))}),d},C=(a,b)=>{let c=Math.max(100,a-48);return i(Number.isFinite(b.wrapWidth)?b.wrapWidth:v(),100,c)},D=(a,b,c)=>{if(!A(b.text))return null;a.font=`bold ${b.fontSize}px Impact, "Arial Black", sans-serif`;let d=C(c,b),e=B(a,b.text,d);if(0===e.length)return null;let f=1.2*b.fontSize,g=d/2+8,h=e.length*f/2+8;return{left:b.x-g,right:b.x+g,top:b.y-h,bottom:b.y+h}},E=(a,b,c)=>{for(let d of[{id:"nw",x:a.left,y:a.top},{id:"ne",x:a.right,y:a.top},{id:"sw",x:a.left,y:a.bottom},{id:"se",x:a.right,y:a.bottom}])if(10>=Math.abs(b-d.x)&&10>=Math.abs(c-d.y))return d.id;return null},F=(a,b,c,d)=>{for(let e=o.length-1;e>=0;e--){let f=o[e],g=D(a,f,b);if(g&&c>=g.left&&c<=g.right&&d>=g.top&&d<=g.bottom)return f}return null},G=(0,f.useCallback)(()=>{let b=a.current,c=d.current;if(!b||!c)return;let e=b.getContext("2d");if(!e)return;let f=c.naturalWidth,g=c.naturalHeight;if(b.width=f,b.height=g,e.drawImage(c,0,0,f,g),o.forEach(a=>((a,b,c)=>{if(!A(b.text))return;let d=Math.max(100,C(c,b));a.font=`bold ${b.fontSize}px Impact, "Arial Black", sans-serif`;let e=B(a,b.text,d);if(0===e.length)return;a.textAlign="center",a.textBaseline="middle",a.lineJoin="round",a.lineWidth=Math.max(2,Math.round(b.fontSize/12)),a.strokeStyle=b.strokeColor,a.fillStyle=b.fillColor;let f=1.2*b.fontSize,g=(e.length-1)*f,h=b.y-g/2;e.forEach((c,d)=>{let e=h+d*f;a.strokeText(c,b.x,e),a.fillText(c,b.x,e)})})(e,a,f)),u){let a=D(e,u,f);a&&(e.strokeStyle="#e0e0e0",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(a.left,a.top,a.right-a.left,a.bottom-a.top),e.setLineDash([]),e.fillStyle="#ffffff",e.strokeStyle="#111111",e.lineWidth=2,[a.left,a.right].forEach(b=>[a.top,a.bottom].forEach(a=>{e.fillRect(b-5,a-5,10,10),e.strokeRect(b-5,a-5,10,10)})))}},[o,u]);(0,f.useEffect)(()=>{if(!m)return;let a=new Image;return a.crossOrigin="anonymous",a.onload=()=>{d.current=a,G()},a.onerror=()=>n(null),a.src=m,()=>{a.src="",m.startsWith("blob:")&&URL.revokeObjectURL(m)}},[m]),(0,f.useEffect)(()=>{G()},[G]);let H=(0,f.useCallback)((b,c)=>{let d=a.current;if(!d)return{x:0,y:0};let e=d.getBoundingClientRect(),f=d.width/e.width,g=d.height/e.height;return{x:(b-e.left)*f,y:(c-e.top)*g}},[]),I=(0,f.useCallback)(b=>{let c=d.current,e=a.current;if(!c||!e)return;let f=e.getContext("2d");if(!f)return;let g=H(b.clientX,b.clientY),h=e.width;if(u){let a=D(f,u,h);if(a){let b=E(a,g.x,g.y);if(b){k.current={active:!0,handle:b,anchor:{left:a.left,right:a.right}},e.style.cursor="nw"===b||"se"===b?"nwse-resize":"nesw-resize";return}}}let i=F(f,h,g.x,g.y);if(i){r(i.id),j.current={active:!0,offsetX:g.x-i.x,offsetY:g.y-i.y},e.style.cursor="grabbing";return}r(null)},[u,H]);(0,f.useEffect)(()=>{let b=a.current;if(!b)return;let c=a=>{if(!d.current)return;let c=H(a.clientX,a.clientY);if(!b.getContext("2d"))return;let e=b.width;if(k.current.active&&u&&k.current.handle){let{handle:a,anchor:b}=k.current,d=b?.left??u.x-C(e,u)/2-8,f=b?.right??u.x+C(e,u)/2+8;"ne"===a||"se"===a?(d=b?.left??d,(f=c.x)-d<116&&(f=d+116)):(f=b?.right??f)-(d=c.x)<116&&(d=f-116),d=i(d,0,e-116),f=i(f,d+116,e);let g=1.2*u.fontSize*2/2+8;y(u.id,{wrapWidth:Math.max(100,f-d-16),x:(d+f)/2,y:"nw"===a||"ne"===a?c.y+g:c.y-g});return}j.current.active&&u&&y(u.id,{x:c.x-j.current.offsetX,y:c.y-j.current.offsetY})},e=()=>{k.current={active:!1,handle:null,anchor:null},j.current={active:!1,offsetX:0,offsetY:0},b&&(b.style.cursor="default")};return window.addEventListener("mousemove",c),window.addEventListener("mouseup",e),()=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",e)}},[u,H,y]);let J=(0,f.useCallback)(b=>{let c=a.current;if(!d.current||!c)return;let e=H(b.clientX,b.clientY),f=c.getContext("2d");if(!f||j.current.active||k.current.active)return;if(u){let a=D(f,u,c.width);if(a){let b=E(a,e.x,e.y);if(b){c.style.cursor="nw"===b||"se"===b?"nwse-resize":"nesw-resize";return}}}let g=F(f,c.width,e.x,e.y);c.style.cursor=g?"grab":"default"},[u,H]),K=(0,f.useCallback)(a=>{let b=a.target.files?.[0];b&&(n(URL.createObjectURL(b)),p([]),r(null),a.target.value="")},[]),L=(0,f.useCallback)(async()=>{let b=a.current,e=d.current;if(b&&e&&l?.id){t(!0);try{let a=await new Promise(a=>b.toBlob(a,"image/png"));if(!a)throw Error("Failed to create image");let e=new File([a],`meme-${Date.now()}.png`,{type:"image/png"}),f=`memes/${(0,g.id)()}.png`,{data:h}=await c.db.storage.uploadFile(f,e,{contentType:"image/png"}),i=h?.id;if(!i)throw Error("File not found after upload");let j=(0,g.id)();await c.db.transact([c.db.tx.memes[j].update({createdAt:Date.now()}).link({image:i,author:l.id})]),n(null),p([]),r(null),d.current=null,window.location.href="/gallery"}catch(a){console.error(a)}finally{t(!1)}}},[l?.id]);return(0,b.jsxs)("div",{className:"flex flex-col h-[calc(100vh-3rem)]",children:[(0,b.jsxs)("div",{className:"flex flex-1 min-h-0",children:[(0,b.jsxs)("aside",{className:"w-[72px] shrink-0 border-r border-[var(--border)] bg-[var(--surface)] flex flex-col",children:[(0,b.jsxs)("div",{className:"p-3 flex flex-col items-center gap-2 border-b border-[var(--border)]",children:[(0,b.jsx)("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-[var(--muted)]",children:"Templates"}),(0,b.jsxs)("label",{className:"flex items-center justify-center w-12 h-12 rounded-lg bg-[#333] cursor-pointer text-xs text-[var(--text)] hover:bg-[#3d3d3d] transition-colors",children:[(0,b.jsx)("span",{children:"Upload"}),(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:K,className:"absolute w-0 h-0 opacity-0 overflow-hidden"})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-2 flex flex-col items-center gap-2",children:h.map(a=>(0,b.jsx)("button",{type:"button",className:"block w-14 h-14 rounded-lg border-2 border-[#3a3a3a] bg-[#2a2a2a] overflow-hidden shrink-0 hover:border-[#555] focus:outline-none focus:border-[#666]",onClick:()=>{n(`/assets/${a}`),p([]),r(null)},children:(0,b.jsx)("img",{src:`/assets/${a}`,alt:"",className:"w-full h-full object-cover"})},a))})]}),(0,b.jsx)("section",{className:"flex-1 flex items-center justify-center p-6 min-h-0",children:(0,b.jsxs)("div",{className:"relative bg-[#2a2a2a] rounded-xl overflow-hidden max-w-full max-h-full flex items-center justify-center min-w-[200px] min-h-[160px] shadow-lg",children:[(0,b.jsx)("canvas",{ref:a,className:"max-w-full max-h-[calc(100vh-12rem)]",onMouseDown:I,onMouseMove:J,onMouseLeave:()=>{a.current&&(a.current.style.cursor="default")}}),!m&&(0,b.jsx)("p",{className:"absolute m-0 text-[var(--muted)] text-sm",children:"Select a template or upload an image"})]})})]}),(0,b.jsx)("div",{className:"flex items-center justify-center pb-4",children:(0,b.jsxs)("div",{className:"flex items-center flex-wrap gap-2 px-4 py-2 bg-[var(--surface)] border border-[var(--border)] rounded-3xl shadow-lg max-w-[min(96vw,720px)]",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)("button",{type:"button",onClick:w,disabled:!d.current,className:"px-3.5 py-2 text-sm font-medium text-[var(--text)] bg-transparent border-none rounded-lg cursor-pointer hover:bg-[#333] disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Text"}),(0,b.jsx)("button",{type:"button",onClick:x,disabled:!q,className:"px-3.5 py-2 text-sm font-medium text-[var(--text)] bg-transparent border-none rounded-lg cursor-pointer hover:bg-red-900/25 hover:text-red-300 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]}),(0,b.jsx)("div",{className:"w-px h-7 bg-[#3a3a3a] mx-2"}),(0,b.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,b.jsx)("span",{className:"text-[10px] uppercase tracking-wide text-[var(--muted)]",children:"Text"}),(0,b.jsx)("textarea",{value:u?.text??"",onChange:a=>u&&y(u.id,{text:a.target.value}),placeholder:u?"Edit selected text":"Select text or Add Text",rows:1,maxLength:300,disabled:!u,className:"w-40 min-h-7 max-h-14 px-2 py-1 text-sm border border-[#3a3a3a] rounded-md bg-[#1e1e1e] text-[var(--text)] placeholder:text-[var(--muted)] resize-none focus:outline-none focus:border-[#555] disabled:opacity-70 disabled:cursor-not-allowed"})]}),(0,b.jsx)("div",{className:"w-px h-7 bg-[#3a3a3a] mx-2"}),(0,b.jsxs)("label",{className:"flex items-center gap-1.5 text-xs text-[var(--muted)]",children:[(0,b.jsx)("span",{children:"Size"}),(0,b.jsx)("output",{className:"min-w-[2ch] tabular-nums",children:u?.fontSize??48}),(0,b.jsx)("input",{type:"range",min:16,max:120,value:u?.fontSize??48,onChange:a=>u&&y(u.id,{fontSize:parseInt(a.target.value,10)}),className:"w-20 h-1.5 accent-[var(--muted)]"})]}),(0,b.jsx)("div",{className:"w-px h-7 bg-[#3a3a3a] mx-2"}),(0,b.jsxs)("label",{className:"flex items-center gap-1.5 text-xs text-[var(--muted)]",children:[(0,b.jsx)("span",{children:"Fill"}),(0,b.jsx)("input",{type:"color",value:u?.fillColor??"#ffffff",onChange:a=>u&&y(u.id,{fillColor:a.target.value}),className:"w-7 h-7 p-0.5 border border-[#3a3a3a] rounded-md bg-[#2a2a2a] cursor-pointer"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-1.5 text-xs text-[var(--muted)]",children:[(0,b.jsx)("span",{children:"Stroke"}),(0,b.jsx)("input",{type:"color",value:u?.strokeColor??"#000000",onChange:a=>u&&y(u.id,{strokeColor:a.target.value}),className:"w-7 h-7 p-0.5 border border-[#3a3a3a] rounded-md bg-[#2a2a2a] cursor-pointer"})]}),(0,b.jsx)("div",{className:"w-px h-7 bg-[#3a3a3a] mx-2"}),(0,b.jsx)("button",{type:"button",onClick:()=>{let b=a.current;if(!b)return;let c=document.createElement("a");c.download=`meme-${Date.now()}.png`,c.href=b.toDataURL("image/png"),c.click()},disabled:!d.current,className:"px-3.5 py-2 text-sm font-medium text-white bg-[#2d2d2d] border-none rounded-lg cursor-pointer hover:bg-[#3d3d3d] disabled:opacity-50 disabled:cursor-not-allowed",children:"Download"}),(0,b.jsx)("button",{type:"button",onClick:L,disabled:!d.current||s,className:"px-3.5 py-2 text-sm font-medium text-black bg-[var(--accent)] border-none rounded-lg cursor-pointer hover:bg-[var(--accent-hover)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:s?"Posting...":"Post to gallery"})]})})]})}function k(){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(c.db.SignedIn,{children:(0,b.jsx)(e.AppShell,{children:(0,b.jsx)(j,{})})}),(0,b.jsx)(c.db.SignedOut,{children:(0,b.jsx)(d.Login,{})})]})}a.s(["default",()=>k],60350)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a1695f1d._.js.map