(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return l}});let l=e=>{}},31713,e=>{"use strict";var t=e.i(43476),r=e.i(8896),l=e.i(86608),a=e.i(25045),n=e.i(71645);e.i(50766);var s=e.i(2909);let i=[];function o(e,t,r){return Math.min(r,Math.max(t,e))}function d(){let e=(0,n.useRef)(null),l=(0,n.useRef)(null),a=(0,n.useRef)(1),d=(0,n.useRef)({active:!1,offsetX:0,offsetY:0}),c=(0,n.useRef)({active:!1,handle:null,anchor:null}),u=r.db.useUser(),[f,x]=(0,n.useState)(null),[h,m]=(0,n.useState)([]),[p,b]=(0,n.useState)(null),[g,w]=(0,n.useState)(!1),v=h.find(e=>e.id===p),y=(0,n.useCallback)(()=>{let e=l.current;return e?o(480,100,Math.max(100,e.naturalWidth-48)):240},[]),j=(0,n.useCallback)(()=>{if(!l.current)return;let e=l.current,t={id:a.current++,text:"New Text",x:e.naturalWidth/2,y:e.naturalHeight/2,fontSize:48,fillColor:"#ffffff",strokeColor:"#000000",wrapWidth:y()};m(e=>[...e,t]),b(t.id)},[y]),k=(0,n.useCallback)(()=>{null!=p&&(m(e=>e.filter(e=>e.id!==p)),b(null))},[p]),N=(0,n.useCallback)((e,t)=>{m(r=>r.map(r=>r.id===e?{...r,...t}:r))},[]),C=e=>e.split("\n").map(e=>e.trim()),S=e=>C(e).some(e=>e.length>0),E=(e,t,r)=>{let l=[];return C(t).forEach(t=>{((e,t,r)=>{if(r<=0||!t)return[""];let l=t.split(/\s+/);if(0===l.length)return[""];let a=[],n=l[0],s=()=>{if(e.measureText(n).width<=r)a.push(n),n="";else{let t=((e,t,r)=>{let l=[],a=t;for(;a&&e.measureText(a).width>r;){let t="";for(let l=0;l<a.length;l++)if(e.measureText(t+a[l]).width<=r)t+=a[l];else break;t?(l.push(t),a=a.slice(t.length)):(l.push(a[0]),a=a.slice(1))}return a&&l.push(a),l})(e,n,r);for(let e=0;e<t.length-1;e++)a.push(t[e]);n=t[t.length-1]||""}};s();for(let t=1;t<l.length;t++){let a=n?n+" "+l[t]:l[t];e.measureText(a).width<=r?n=a:(n&&s(),n=l[t],s())}return n&&a.push(n),a})(e,t,r).forEach(e=>l.push(e))}),l},z=(e,t)=>{let r=Math.max(100,e-48);return o(Number.isFinite(t.wrapWidth)?t.wrapWidth:y(),100,r)},R=(e,t,r)=>{if(!S(t.text))return null;e.font=`bold ${t.fontSize}px Impact, "Arial Black", sans-serif`;let l=z(r,t),a=E(e,t.text,l);if(0===a.length)return null;let n=1.2*t.fontSize,s=l/2+8,i=a.length*n/2+8;return{left:t.x-s,right:t.x+s,top:t.y-i,bottom:t.y+i}},T=(e,t,r)=>{for(let l of[{id:"nw",x:e.left,y:e.top},{id:"ne",x:e.right,y:e.top},{id:"sw",x:e.left,y:e.bottom},{id:"se",x:e.right,y:e.bottom}])if(10>=Math.abs(t-l.x)&&10>=Math.abs(r-l.y))return l.id;return null},M=(e,t,r,l)=>{for(let a=h.length-1;a>=0;a--){let n=h[a],s=R(e,n,t);if(s&&r>=s.left&&r<=s.right&&l>=s.top&&l<=s.bottom)return n}return null},L=(0,n.useCallback)(()=>{let t=e.current,r=l.current;if(!t||!r)return;let a=t.getContext("2d");if(!a)return;let n=r.naturalWidth,s=r.naturalHeight;if(t.width=n,t.height=s,a.drawImage(r,0,0,n,s),h.forEach(e=>((e,t,r)=>{if(!S(t.text))return;let l=Math.max(100,z(r,t));e.font=`bold ${t.fontSize}px Impact, "Arial Black", sans-serif`;let a=E(e,t.text,l);if(0===a.length)return;e.textAlign="center",e.textBaseline="middle",e.lineJoin="round",e.lineWidth=Math.max(2,Math.round(t.fontSize/12)),e.strokeStyle=t.strokeColor,e.fillStyle=t.fillColor;let n=1.2*t.fontSize,s=(a.length-1)*n,i=t.y-s/2;a.forEach((r,l)=>{let a=i+l*n;e.strokeText(r,t.x,a),e.fillText(r,t.x,a)})})(a,e,n)),v){let e=R(a,v,n);e&&(a.strokeStyle="#e0e0e0",a.lineWidth=2,a.setLineDash([5,5]),a.strokeRect(e.left,e.top,e.right-e.left,e.bottom-e.top),a.setLineDash([]),a.fillStyle="#ffffff",a.strokeStyle="#111111",a.lineWidth=2,[e.left,e.right].forEach(t=>[e.top,e.bottom].forEach(e=>{a.fillRect(t-5,e-5,10,10),a.strokeRect(t-5,e-5,10,10)})))}},[h,v]);(0,n.useEffect)(()=>{if(!f)return;let e=new Image;return e.crossOrigin="anonymous",e.onload=()=>{l.current=e,L()},e.onerror=()=>x(null),e.src=f,()=>{e.src="",f.startsWith("blob:")&&URL.revokeObjectURL(f)}},[f]),(0,n.useEffect)(()=>{L()},[L]);let W=(0,n.useCallback)((t,r)=>{let l=e.current;if(!l)return{x:0,y:0};let a=l.getBoundingClientRect(),n=l.width/a.width,s=l.height/a.height;return{x:(t-a.left)*n,y:(r-a.top)*s}},[]),A=(0,n.useCallback)(t=>{let r=l.current,a=e.current;if(!r||!a)return;let n=a.getContext("2d");if(!n)return;let s=W(t.clientX,t.clientY),i=a.width;if(v){let e=R(n,v,i);if(e){let t=T(e,s.x,s.y);if(t){c.current={active:!0,handle:t,anchor:{left:e.left,right:e.right}},a.style.cursor="nw"===t||"se"===t?"nwse-resize":"nesw-resize";return}}}let o=M(n,i,s.x,s.y);if(o){b(o.id),d.current={active:!0,offsetX:s.x-o.x,offsetY:s.y-o.y},a.style.cursor="grabbing";return}b(null)},[v,W]);(0,n.useEffect)(()=>{let t=e.current;if(!t)return;let r=e=>{if(!l.current)return;let r=W(e.clientX,e.clientY);if(!t.getContext("2d"))return;let a=t.width;if(c.current.active&&v&&c.current.handle){let{handle:e,anchor:t}=c.current,l=t?.left??v.x-z(a,v)/2-8,n=t?.right??v.x+z(a,v)/2+8;"ne"===e||"se"===e?(l=t?.left??l,(n=r.x)-l<116&&(n=l+116)):(n=t?.right??n)-(l=r.x)<116&&(l=n-116),l=o(l,0,a-116),n=o(n,l+116,a);let s=1.2*v.fontSize*2/2+8;N(v.id,{wrapWidth:Math.max(100,n-l-16),x:(l+n)/2,y:"nw"===e||"ne"===e?r.y+s:r.y-s});return}d.current.active&&v&&N(v.id,{x:r.x-d.current.offsetX,y:r.y-d.current.offsetY})},a=()=>{c.current={active:!1,handle:null,anchor:null},d.current={active:!1,offsetX:0,offsetY:0},t&&(t.style.cursor="default")};return window.addEventListener("mousemove",r),window.addEventListener("mouseup",a),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",a)}},[v,W,N]);let D=(0,n.useCallback)(t=>{let r=e.current;if(!l.current||!r)return;let a=W(t.clientX,t.clientY),n=r.getContext("2d");if(!n||d.current.active||c.current.active)return;if(v){let e=R(n,v,r.width);if(e){let t=T(e,a.x,a.y);if(t){r.style.cursor="nw"===t||"se"===t?"nwse-resize":"nesw-resize";return}}}let s=M(n,r.width,a.x,a.y);r.style.cursor=s?"grab":"default"},[v,W]),O=(0,n.useCallback)(e=>{let t=e.target.files?.[0];t&&(x(URL.createObjectURL(t)),m([]),b(null),e.target.value="")},[]),U=(0,n.useCallback)(async()=>{let t=e.current,a=l.current;if(t&&a&&u?.id){w(!0);try{let e=await new Promise(e=>t.toBlob(e,"image/png"));if(!e)throw Error("Failed to create image");let a=new File([e],`meme-${Date.now()}.png`,{type:"image/png"}),n=`memes/${(0,s.id)()}.png`,{data:i}=await r.db.storage.uploadFile(n,a,{contentType:"image/png"}),o=i?.id;if(!o)throw Error("File not found after upload");let d=(0,s.id)();await r.db.transact([r.db.tx.memes[d].update({createdAt:Date.now()}).link({image:o,author:u.id})]),x(null),m([]),b(null),l.current=null,window.location.href="/gallery"}catch(e){console.error(e)}finally{w(!1)}}},[u?.id]);return(0,t.jsxs)("div",{className:"flex flex-col h-[calc(100vh-3rem)]",children:[(0,t.jsxs)("div",{className:"flex flex-1 min-h-0",children:[(0,t.jsxs)("aside",{className:"w-[72px] shrink-0 border-r border-[var(--border)] bg-[var(--surface)] flex flex-col",children:[(0,t.jsxs)("div",{className:"p-3 flex flex-col items-center gap-2 border-b border-[var(--border)]",children:[(0,t.jsx)("span",{className:"text-[10px] font-semibold uppercase tracking-wide text-[var(--muted)]",children:"Templates"}),(0,t.jsxs)("label",{className:"flex items-center justify-center w-12 h-12 rounded-lg bg-[#333] cursor-pointer text-xs text-[var(--text)] hover:bg-[#3d3d3d] transition-colors",children:[(0,t.jsx)("span",{children:"Upload"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:O,className:"absolute w-0 h-0 opacity-0 overflow-hidden"})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-2 flex flex-col items-center gap-2",children:i.map(e=>(0,t.jsx)("button",{type:"button",className:"block w-14 h-14 rounded-lg border-2 border-[#3a3a3a] bg-[#2a2a2a] overflow-hidden shrink-0 hover:border-[#555] focus:outline-none focus:border-[#666]",onClick:()=>{x(`/assets/${e}`),m([]),b(null)},children:(0,t.jsx)("img",{src:`/assets/${e}`,alt:"",className:"w-full h-full object-cover"})},e))})]}),(0,t.jsx)("section",{className:"flex-1 flex items-center justify-center p-6 min-h-0",children:(0,t.jsxs)("div",{className:"relative bg-[#2a2a2a] rounded-xl overflow-hidden max-w-full max-h-full flex items-center justify-center min-w-[200px] min-h-[160px] shadow-lg",children:[(0,t.jsx)("canvas",{ref:e,className:"max-w-full max-h-[calc(100vh-12rem)]",onMouseDown:A,onMouseMove:D,onMouseLeave:()=>{e.current&&(e.current.style.cursor="default")}}),!f&&(0,t.jsx)("p",{className:"absolute m-0 text-[var(--muted)] text-sm",children:"Select a template or upload an image"})]})})]}),(0,t.jsx)("div",{className:"flex items-center justify-center pb-4",children:(0,t.jsxs)("div",{className:"flex items-center flex-wrap gap-2 px-4 py-2 bg-[var(--surface)] border border-[var(--border)] rounded-3xl shadow-lg max-w-[min(96vw,720px)]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("button",{type:"button",onClick:j,disabled:!l.current,className:"px-3.5 py-2 text-sm font-medium text-[var(--text)] bg-transparent border-none rounded-lg cursor-pointer hover:bg-[#333] disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Text"}),(0,t.jsx)("button",{type:"button",onClick:k,disabled:!p,className:"px-3.5 py-2 text-sm font-medium text-[var(--text)] bg-transparent border-none rounded-lg cursor-pointer hover:bg-red-900/25 hover:text-red-300 disabled:opacity-50 disabled:cursor-not-allowed",children:"Delete"})]}),(0,t.jsx)("div",{className:"w-px h-7 bg-[#3a3a3a] mx-2"}),(0,t.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,t.jsx)("span",{className:"text-[10px] uppercase tracking-wide text-[var(--muted)]",children:"Text"}),(0,t.jsx)("textarea",{value:v?.text??"",onChange:e=>v&&N(v.id,{text:e.target.value}),placeholder:v?"Edit selected text":"Select text or Add Text",rows:1,maxLength:300,disabled:!v,className:"w-40 min-h-7 max-h-14 px-2 py-1 text-sm border border-[#3a3a3a] rounded-md bg-[#1e1e1e] text-[var(--text)] placeholder:text-[var(--muted)] resize-none focus:outline-none focus:border-[#555] disabled:opacity-70 disabled:cursor-not-allowed"})]}),(0,t.jsx)("div",{className:"w-px h-7 bg-[#3a3a3a] mx-2"}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 text-xs text-[var(--muted)]",children:[(0,t.jsx)("span",{children:"Size"}),(0,t.jsx)("output",{className:"min-w-[2ch] tabular-nums",children:v?.fontSize??48}),(0,t.jsx)("input",{type:"range",min:16,max:120,value:v?.fontSize??48,onChange:e=>v&&N(v.id,{fontSize:parseInt(e.target.value,10)}),className:"w-20 h-1.5 accent-[var(--muted)]"})]}),(0,t.jsx)("div",{className:"w-px h-7 bg-[#3a3a3a] mx-2"}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 text-xs text-[var(--muted)]",children:[(0,t.jsx)("span",{children:"Fill"}),(0,t.jsx)("input",{type:"color",value:v?.fillColor??"#ffffff",onChange:e=>v&&N(v.id,{fillColor:e.target.value}),className:"w-7 h-7 p-0.5 border border-[#3a3a3a] rounded-md bg-[#2a2a2a] cursor-pointer"})]}),(0,t.jsxs)("label",{className:"flex items-center gap-1.5 text-xs text-[var(--muted)]",children:[(0,t.jsx)("span",{children:"Stroke"}),(0,t.jsx)("input",{type:"color",value:v?.strokeColor??"#000000",onChange:e=>v&&N(v.id,{strokeColor:e.target.value}),className:"w-7 h-7 p-0.5 border border-[#3a3a3a] rounded-md bg-[#2a2a2a] cursor-pointer"})]}),(0,t.jsx)("div",{className:"w-px h-7 bg-[#3a3a3a] mx-2"}),(0,t.jsx)("button",{type:"button",onClick:()=>{let t=e.current;if(!t)return;let r=document.createElement("a");r.download=`meme-${Date.now()}.png`,r.href=t.toDataURL("image/png"),r.click()},disabled:!l.current,className:"px-3.5 py-2 text-sm font-medium text-white bg-[#2d2d2d] border-none rounded-lg cursor-pointer hover:bg-[#3d3d3d] disabled:opacity-50 disabled:cursor-not-allowed",children:"Download"}),(0,t.jsx)("button",{type:"button",onClick:U,disabled:!l.current||g,className:"px-3.5 py-2 text-sm font-medium text-black bg-[var(--accent)] border-none rounded-lg cursor-pointer hover:bg-[var(--accent-hover)] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:g?"Posting...":"Post to gallery"})]})})]})}function c(){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.db.SignedIn,{children:(0,t.jsx)(a.AppShell,{children:(0,t.jsx)(d,{})})}),(0,t.jsx)(r.db.SignedOut,{children:(0,t.jsx)(l.Login,{})})]})}e.s(["default",()=>c],31713)}]);